VERSION 5.00
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCTL.OCX"
Begin VB.Form frmLaserReadingsIII 
   BackColor       =   &H00C0FFC0&
   Caption         =   "LaserClass II & III"
   ClientHeight    =   11010
   ClientLeft      =   5505
   ClientTop       =   3990
   ClientWidth     =   15240
   LinkTopic       =   "Form2"
   ScaleHeight     =   11010
   ScaleWidth      =   15240
   StartUpPosition =   2  'CenterScreen
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   19
      Left            =   11760
      TabIndex        =   33
      Top             =   4800
      Visible         =   0   'False
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   18
      Left            =   9720
      TabIndex        =   32
      Top             =   7680
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   17
      Left            =   9720
      TabIndex        =   31
      Top             =   7320
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   16
      Left            =   9720
      TabIndex        =   30
      Top             =   6960
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   15
      Left            =   9720
      TabIndex        =   29
      Top             =   6600
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   14
      Left            =   9720
      TabIndex        =   28
      Top             =   6240
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   13
      Left            =   9720
      TabIndex        =   27
      Top             =   5880
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   12
      Left            =   9720
      TabIndex        =   26
      Top             =   5160
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   11
      Left            =   9720
      TabIndex        =   25
      Top             =   5520
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   10
      Left            =   9720
      TabIndex        =   24
      Top             =   4800
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   9
      Left            =   7800
      TabIndex        =   23
      Top             =   7680
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   8
      Left            =   7800
      TabIndex        =   22
      Top             =   7320
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   7
      Left            =   7800
      TabIndex        =   21
      Top             =   6600
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   6
      Left            =   7800
      TabIndex        =   20
      Top             =   6960
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   5
      Left            =   7800
      TabIndex        =   19
      Top             =   6240
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   4
      Left            =   7800
      TabIndex        =   18
      Top             =   5880
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   3
      Left            =   7800
      TabIndex        =   17
      Top             =   5520
      Width           =   1815
   End
   Begin VB.CommandButton cmdLaserReadings 
      BackColor       =   &H00FFFF80&
      Caption         =   "Take Laser Readings"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   18
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   735
      Left            =   2400
      Style           =   1  'Graphical
      TabIndex        =   11
      Top             =   2760
      Width           =   6855
   End
   Begin VB.CommandButton cmdResetLaser 
      BackColor       =   &H00FFFF00&
      Caption         =   "Reset Laser"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   18
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   735
      Left            =   9960
      Style           =   1  'Graphical
      TabIndex        =   10
      Top             =   2760
      Width           =   2295
   End
   Begin VB.Timer tmrLaserReadTrigger 
      Interval        =   1
      Left            =   11280
      Top             =   10080
   End
   Begin VB.Timer tmrLiveLaserReading 
      Interval        =   100
      Left            =   10800
      Top             =   10080
   End
   Begin VB.CommandButton cmdNo 
      BackColor       =   &H00FFFF80&
      Caption         =   "No"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   13.5
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   495
      Left            =   12120
      MaskColor       =   &H00FFFF80&
      Style           =   1  'Graphical
      TabIndex        =   8
      Top             =   7320
      Width           =   2055
   End
   Begin VB.CommandButton cmdYes 
      BackColor       =   &H00FFFF80&
      Caption         =   "Yes"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   13.5
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   495
      Left            =   12120
      MaskColor       =   &H00FFFF80&
      Style           =   1  'Graphical
      TabIndex        =   7
      Top             =   6600
      Width           =   2055
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   2
      Left            =   7800
      TabIndex        =   2
      Top             =   5160
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   1
      Left            =   7800
      TabIndex        =   1
      Top             =   4800
      Width           =   1815
   End
   Begin VB.TextBox txtLaserReading 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   375
      Index           =   0
      Left            =   5880
      TabIndex        =   0
      Top             =   4800
      Visible         =   0   'False
      Width           =   1695
   End
   Begin MSComctlLib.ProgressBar pbBeamStrength 
      Height          =   9855
      Left            =   14520
      TabIndex        =   15
      Top             =   720
      Width           =   615
      _ExtentX        =   1085
      _ExtentY        =   17383
      _Version        =   393216
      Appearance      =   1
      Orientation     =   1
      Scrolling       =   1
   End
   Begin VB.Label Label10 
      BackStyle       =   0  'Transparent
      Caption         =   "m"
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   72
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1335
      Left            =   6120
      TabIndex        =   37
      Top             =   5880
      Width           =   1335
   End
   Begin VB.Label lblTargetLength 
      BackStyle       =   0  'Transparent
      Caption         =   "Goto"
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   72
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1335
      Left            =   1080
      TabIndex        =   36
      Top             =   5880
      Width           =   4815
   End
   Begin VB.Label lblBeamStrength 
      BackStyle       =   0  'Transparent
      Caption         =   "%"
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   18
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   735
      Left            =   14520
      TabIndex        =   35
      Top             =   0
      Width           =   615
   End
   Begin VB.Label Label8 
      BackColor       =   &H8000000A&
      BackStyle       =   0  'Transparent
      Caption         =   "%"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   18
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   615
      Left            =   17280
      TabIndex        =   34
      Top             =   9120
      Width           =   375
   End
   Begin VB.Label Label7 
      BackColor       =   &H00C0FFC0&
      Caption         =   "Beam strength"
      Height          =   375
      Left            =   16680
      TabIndex        =   16
      Top             =   9720
      Width           =   1095
   End
   Begin VB.Label lblUnits 
      AutoSize        =   -1  'True
      BackColor       =   &H00C0FFC0&
      Caption         =   "mm"
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   72
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1605
      Left            =   9960
      TabIndex        =   14
      Top             =   1080
      Width           =   2475
   End
   Begin VB.Label Label6 
      BackColor       =   &H00C0FFC0&
      Caption         =   "Click on 'Take Laser Readings'/Record to start"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   24
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   735
      Left            =   1440
      TabIndex        =   13
      Top             =   240
      Width           =   11055
   End
   Begin VB.Label lblDispLaser 
      Alignment       =   1  'Right Justify
      AutoSize        =   -1  'True
      BackColor       =   &H00C0FFC0&
      Caption         =   "0.000 00"
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   72
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1605
      Left            =   3720
      TabIndex        =   12
      Top             =   1080
      Width           =   5580
   End
   Begin VB.Label Label1 
      BackColor       =   &H00C0FFC0&
      Caption         =   "Are the results OK?"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   13.5
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   855
      Left            =   12000
      TabIndex        =   9
      Top             =   5520
      Width           =   1575
   End
   Begin VB.Label Label5 
      BackStyle       =   0  'Transparent
      Caption         =   "Zero Reading"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   13.5
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   11640
      TabIndex        =   6
      Top             =   4320
      Width           =   1815
   End
   Begin VB.Label Label4 
      BackColor       =   &H00C0FFC0&
      Caption         =   "Graduation reading"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   13.5
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   9720
      TabIndex        =   5
      Top             =   4320
      Width           =   1815
   End
   Begin VB.Label Label3 
      BackColor       =   &H00C0FFC0&
      Caption         =   "Graduation reading"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   13.5
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   7800
      TabIndex        =   4
      Top             =   4320
      Width           =   1695
   End
   Begin VB.Label Label2 
      BackStyle       =   0  'Transparent
      Caption         =   "Zero Reading"
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   13.5
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   5640
      TabIndex        =   3
      Top             =   4320
      Width           =   1935
   End
End
Attribute VB_Name = "frmLaserReadingsIII"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False

Option Explicit
Dim iPts As Integer 'counter for the number of readings taken
Dim iTNPts As Integer 'Total number of required points
Public laser As Integer
Public counter As Integer
Dim DepartmentNo As String



Private Sub CmdYes_Click()
    'Load frmManualEdaleEntry
    'frmManualEdaleEntry.Show
    'Unload Me
    'load Manual Edale form and unload current form
    iPts = 0 'Reset the counter
    
    
    
    '======================================
    'Agilent SBB 8/3/2010
    xlbookResults.Save
PrintOutClassC
CleanUp ' run cleanup module to close out system
End
'shows final sheet
Unload Me

End Sub
Private Sub CmdNo_Click()
Dim X As Integer
If Not cmdResetLaser.Enabled Then cmdResetLaser.Enabled = True
    For X = 0 To iTNPts 'Agilent sbb 8/3/2010  , was 3
        txtLaserReading(X).Text = 0 'when 'no' button clicked,
        'clears text boxes by placing a zero in them
        xlsheetResultsMeasurement.Cells(X + 2, Rownumber) = ""
        'This clears the results in excel as row index, column index
    Next X
' do the last Zero
X = 19
txtLaserReading(X).Text = 0 'when 'no' button clicked,
'clears text boxes by placing a zero in them
xlsheetResultsMeasurement.Cells(X + 2, Rownumber) = ""
iPts = 0
'makes the text boxes invisible until the take laser readings button has been pressed_
'this is to make people press this button otherwise program can crash
End Sub

Private Sub cmdLaserReadings_Click()
'   Button on screen has been pressed, take the laser reading
'Call RecordBtnPressed
Dim ResponseString As String
Dim Response As String
Dim DepartmentNo As String
Dim dbReading As Double
Dim sngDist As Single
On Error GoTo ErrorTrap
If cmdResetLaser.Enabled Then cmdResetLaser.Enabled = False
If iPts > 19 Then GoTo ExitSub
dbReading = TakeLaserReadings
If iPts > iTNPts Then iPts = 19 'Next reading or the last Zero(Datum)
'    'If Not txtLaserReading(0).Visible Then Call ShowReadingBox 'Agilent removed SBB 8/3/2010
'    Beep
'Else
'    iPts = 19   'Places the reading in the appropriate cell
'End If

Call DispLaserReading(txtLaserReading(iPts), dbReading)
Call PutReadingInExcel(dbReading, iPts, LaserTestSetNo)
iPts = iPts + 1
sngDist = Val(xlsheetResultsMeasurement.Cells(iPts + 3, 7))
lblTargetLength.Caption = Format(sngDist, "#0.000")
'places result from text box into row 3, column 2 on xl sheet
Refresh

Beep
ExitSub:
Exit Sub
ErrorTrap:
ResponseString = "The error was " & Err.Description & vbCrLf & "The error number was " & Err.Number
Response = MsgBox(ResponseString, vbOKOnly)
On Error GoTo 0
End
End Sub




Private Sub cmdResetLaser_Click()
'   Reset the laser
Call ResetBtnPressed
E1735A_ResetDevice

End Sub

Private Sub Form_Load()
Call SetDefaults

End Sub


Private Sub tmrLaserReadTrigger_Timer()
'   Checks to see if the remote has been pressed
'   If it has, take the laser reading
Dim dbReading As Double
Dim sngDist As Single
Debug.Print E1735A_ReadSampleCount()
If Not (E1735A_ReadLastError = 0) Then Call AgilentError(1)
   If E1735A_ReadSampleCount() > 0 Then
        'If iPts <= iTNPts Then
        If iPts > iTNPts Then iPts = 19
           'If Not txtLaserReading(0).Visible Then Call ShowReadingBox  'Agilent Removed SBB 8/3/2010
            Call ReadAllSamples(dbReading)
            Call DispLaserReading(txtLaserReading(iPts), dbReading)
            Call PutReadingInExcel(dbReading, iPts, LaserTestSetNo)
            iPts = iPts + 1
            sngDist = Val(xlsheetResultsMeasurement.Cells(iPts + 3, 7))
            lblTargetLength.Caption = Format(sngDist, "#0.000")

        'End If
    End If
End Sub

Public Sub ReadAllSamples(dbReading As Double)
 Dim Buffer() As TLaserSample
  Dim Size, Got, i, j, Interval As Long

  Size = 1024
  
  ReDim Buffer(1 To Size) As TLaserSample
 
  
    Got = E1735A_ReadAllSamples(Buffer(1), Size)
    
    
    j = Got / 20
    
    If j >= 1 Then
       Interval = j
    Else
       Interval = 1
    End If
    
    i = 0
    
    For i = 1 To Got Step Interval
         dbReading = Buffer(i).LaserPos

    Next i
End Sub

Public Sub SetDefaults()
Dim trg As Integer
Dim sngDist As Single
trg = 6 'remote and software
Call E1735A_SetSampleTriggers(trg)

iTNPts = NoOfPoints 'Total number of calibration points, Agilent SBB 8/3/2010
iPts = 0
pbBeamStrength.Max = 100
pbBeamStrength.Min = 0
SetProgressBackColour pbBeamStrength.hwnd, vbRed
SetProgressBarColour pbBeamStrength.hwnd, vbGreen
sngDist = Val(xlsheetResultsMeasurement.Cells(iPts + 3, 7))
lblTargetLength.Caption = Format(sngDist, "## 000.000 00")
ShowReadingBox
End Sub


Private Sub tmrLiveLaserReading_Timer()
Dim intBmStr As Integer
Dim iBtn As Integer
Dim iAglErr As Integer
'   Continuosly reads the laser and displays the reading
lblDispLaser.Caption = Format(E1735A_ReadSample(), "+## ##0.000 00;-## ##0.000 00")
'   Have any of the buttons been pressed
iBtn = E1735A_ReadButtonClicked
If Not (iBtn = 0) Then Call ButtonPressed(iBtn)
'   Any errors from the laser
iAglErr = E1735A_ReadLastError
If Not (iAglErr = 0) Then
    Call AgilentError(iAglErr)
Else
    Debug.Print "No error"
End If
intBmStr = E1735A_ReadBeamStrength * 100
pbBeamStrength.value = intBmStr
lblBeamStrength.Caption = Format(intBmStr, "#0")
End Sub


Public Sub ShowReadingBox()
'   Make the text boxes for the laser reading visible
Dim iPt As Integer
For iPt = 0 To iTNPts
    txtLaserReading(iPt).Visible = True
Next iPt
'   Make the last Zero visible
    txtLaserReading(19).Visible = True

End Sub

Public Sub PutReadingInExcel(dbReading As Double, iRow As Integer, iCol As Integer)
xlsheetResultsMeasurement.Cells(iRow + 3, iCol) = dbReading
End Sub

Public Sub DispLaserReading(TxtBox As TextBox, dbRdg As Double)

'   Formats and displays the text txtDisp into the text box txtBox
TxtBox.Text = Format(dbRdg, "+00 000.000 00;-00 000.000 00")
End Sub

Private Sub txtTargetLength_Change()

End Sub

Public Sub ButtonPressed(iBtn As Integer)
Debug.Print iBtn
'If iBtn = 1 Then Call RecordBtnPressed
'If iBtn = 2 Then Call ResetBtnPressed
End Sub

Public Sub AgilentError(iAglErr As Integer)
Debug.Print iAglErr

End Sub

Public Sub RecordBtnPressed()
Dim dbReading As Double
Dim sngDist As Single
Debug.Print E1735A_ReadSampleCount()
If Not (E1735A_ReadLastError = 0) Then Call AgilentError(1)
   If E1735A_ReadSampleCount() > 0 Then
        If iPts > iTNPts Then iPts = 19
         Call ReadAllSamples(dbReading)
         Call DispLaserReading(txtLaserReading(iPts), dbReading)
         Call PutReadingInExcel(dbReading, iPts, LaserTestSetNo)
         iPts = iPts + 1
         sngDist = Val(xlsheetResultsMeasurement.Cells(iPts + 3, 7))
         lblTargetLength.Caption = Format(sngDist, "#0.000")
    End If

End Sub

Public Sub ResetBtnPressed()
'   Reset the laser
E1735A_ResetDevice
End Sub
